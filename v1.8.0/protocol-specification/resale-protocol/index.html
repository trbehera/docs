<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Secure Device Onboard Contributers">
        <link rel="canonical" href="https://secure-device-onboard.github.io/docs/protocol-specification/resale-protocol/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Resale Protocol - Secure Device Onboard</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../css/version-select.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Secure Device Onboard</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="navitem">
                                <a href="../../community/" class="nav-link">Community</a>
                            </li>
                            <li class="navitem">
                                <a href="../../releases/" class="nav-link">Releases</a>
                            </li>
                            <li class="navitem">
                                <a href="../../security-best-practices/security-best-practices/" class="nav-link">Security Best Practices</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Client SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../client-sdk/client-sdk-reference-guide/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../client-sdk/client-sdk-api-reference/" class="dropdown-item">API Reference</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">IOT Platform SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../iot-platform-sdk/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../iot-platform-sdk/running-the-demo/" class="dropdown-item">Running The Demo</a>
</li>
                                    
<li>
    <a href="../../iot-platform-sdk/development-guide/" class="dropdown-item">Development Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Rendezvous Service <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../rendezvous-service/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Supply Chain Tools <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../supply-chain-tools/manufacturing/manufacturer-enablement-guide/" class="dropdown-item">Manufacturing Tools</a>
</li>
                                    
<li>
    <a href="../../supply-chain-tools/reseller/reseller-enablement-guide/" class="dropdown-item">Reseller Tools</a>
</li>
                                    
<li>
    <a href="../../supply-chain-tools/keystore-guide/" class="dropdown-item">Keystore Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Reference Implementation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../protocol-reference-implementation/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">All-in-one Demo <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../all-in-one-demo/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Specification <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../protocol-description/" class="dropdown-item">Protocol Description</a>
</li>
                                    
<li>
    <a href="../protocol-data-types/" class="dropdown-item">Protocol Data Types</a>
</li>
                                    
<li>
    <a href="../data-transmission-persistence/" class="dropdown-item">Data Transmission & Persistence</a>
</li>
                                    
<li>
    <a href="../detailed-protocol-description/" class="dropdown-item">Detailed Protocol Description</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Resale Protocol</a>
</li>
                                    
<li>
    <a href="../credential-reuse-protocol/" class="dropdown-item">Credential Reuse Protocol</a>
</li>
                                    
<li>
    <a href="../appendix-b-device-provisioning-with-ecdsa/" class="dropdown-item">Appendix B - Device Provisioning with ECDSA</a>
</li>
                                    
<li>
    <a href="../appendix-c-secure-device-onboard-1-1-crypto-upgrade/" class="dropdown-item">Appendix C - Secure Device Onboard 1.1 Crypto Upgrade</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../detailed-protocol-description/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../credential-reuse-protocol/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#resale-protocol" class="nav-link">Resale Protocol</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#secure-device-onboard-devices-that-do-not-support-resale" class="nav-link">Secure Device Onboard Devices that Do Not Support Resale</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#secure-device-onboard-owner-that-does-not-support-resale" class="nav-link">Secure Device Onboard Owner that Does Not Support Resale</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="resale-protocol">Resale Protocol<a class="headerlink" href="#resale-protocol" title="Permanent link">&para;</a></h1>
<p>After the transfer of ownership completes (For example, the TO2 Protocol finishes), the
Device switches to an idle state (Device Secure Device Onboard State = IDLE), which inhibits the
device’s software from running Secure Device Onboard. See
the Secure Device Onboard Architectural Specification for a
description of Secure Device Onboard Device States.</p>
<p>A device implementation might also stop a thread or process from running to
achieve the same effect, perhaps freeing resources for Device operation. In the
case of a MCU-based implementation, the Secure Device Onboard code might only be able to run
when external software calls a specific entry point for it.</p>
<p>The Owner may use System or OS level commands to re-enable Secure Device Onboard for a new
transfer of Ownership. In complex operating systems, this can be done by setting
the device to the ReadyN (Transfer Ready) state; other system level measures
must be arranged on a per-implementation basis.</p>
<p>In the TO2 Protocol (section <a href="../detailed-protocol-description/#transfer-ownership-protocol-2">§</a>), the Secure Device Onboard software in the Device TEE stores new
credentials that are only known to the Owner. How the device info is updated is
described in section <a href="../detailed-protocol-description/#to2setupdevice-type-47">§</a>, which describes the
TO2.SetupDevice message. Please note that the public
key stored in the device is updated to the “Owner2” key, a key that is separate
from the Owner key in the original Ownership Voucher. This is to prevent any way
of correlating the original Ownership Voucher from the one being generated for
resale in the TO2 Protocol.</p>
<p>Subsequently, in the TO2.Done message, the Device transfers
to the Owner the HMAC of the stored device credentials. This HMAC is used by the
Owner exactly as the HMAC supplied to the ODM in the
DI.SetHMAC message is used, to create a new Ownership
Voucher.</p>
<p>Resale, then, involves the following steps:</p>
<ol>
<li>
<p>The Device is reconditioned to remove all run-time changes and brought back
    to a factory state. This includes removing any secrets, except for the Secure Device Onboard credentials from the TO2 Protocol.</p>
</li>
<li>
<p>The Device is instructed to transition to a ReadyN state, and any other
    actions needed to enable to Secure Device Onboard Device software to run are performed.</p>
</li>
<li>
<p>At this point, the Device is ready to transfer ownership. It may be powered
    down, shipped, and re-installed in a new location. Note that the GUID in the
    Device has changed since it was manufactured.</p>
</li>
<li>
<p>The Owner transfers the Ownership Voucher to the Manufacturing tool.</p>
</li>
<li>
<p>The Manufacturing tool signs the Ownership Voucher to the next Owner and
    sends the updated Ownership Voucher on.</p>
</li>
<li>
<p>Eventually, the new Owner receives the new Ownership Voucher, with a
    signature chain of one or more signatures. The new Owner initiates the TO0
    Protocol.</p>
</li>
<li>
<p>Eventually, the Device is installed in its new location. The Device starts
    to run the TO1 Protocol to determine the new Owner’s Internet location.</p>
</li>
<li>
<p>The Device segues from TO1 to TO2 Protocol to transfer ownership to the new
    Owner.</p>
</li>
<li>
<p>As a side effect, yet another Ownership Voucher is created for the new
    Owner, and so on.</p>
</li>
</ol>
<p>It may be that, when resale time comes, the Owner wishes to change the
rendezvous information that is stored in the Device TEE. This may be
accomplished by performing a transfer of ownership (using the TO2 Protocol) from
the Owner to itself, allowing replacement of the credentials in the
TO2.SetupDevice message.</p>
<h2 id="secure-device-onboard-devices-that-do-not-support-resale">Secure Device Onboard Devices that Do Not Support Resale<a class="headerlink" href="#secure-device-onboard-devices-that-do-not-support-resale" title="Permanent link">&para;</a></h2>
<p>A device may, at its option, implement only a limited number of Secure Device Onboard 
transfers of ownership. There are various reasons for this:</p>
<ul>
<li>
<p>Each transfer might consume some OTP memory, and the total amount is
    limited.</p>
</li>
<li>
<p>A device is intended to be discarded after its first Ownership Transfer.</p>
</li>
<li>
<p>The ability to use Secure Device Onboard again on a Device might be
    thought of as an attack vector to disable or even steal the device as the
    latter requires compromising both the Device and its current Owner.</p>
</li>
</ul>
<p>In this case, the Device must be careful to disable Secure Device Onboard
software after the initial transfer of ownership succeeds. This can be
accomplished using the Device State: PD (Permanently Disabled). If Secure Device Onboard is
disabled for security reasons, it is best also to destroy any credentials in the
Device or to prevent the code from running using ad hoc mechanisms, such as
uninstalling the application code.</p>
<p>As described in section <a href="../detailed-protocol-description/#to2done-type-50">§</a>, the TO2.Done message can also inform the Owner
of the Device’s inability to perform resale by transmitting zero length HMAC.</p>
<h2 id="secure-device-onboard-owner-that-does-not-support-resale">Secure Device Onboard Owner that Does Not Support Resale<a class="headerlink" href="#secure-device-onboard-owner-that-does-not-support-resale" title="Permanent link">&para;</a></h2>
<p>An Owner may elect not to support the resale capability, even if the underlying
Device is capable of doing so. The Owner is still required to provide new
credentials for the Device in the [TO2.SetupDevice]
message. The Owner should then discard the credentials in a manner that will
ensure that neither the Owner itself nor any malicious party can ever obtain
them. This involves:</p>
<ul>
<li>
<p>The Owner must ensure the security of the Owner2 private key such as
    discarding the key.</p>
</li>
<li>
<p>The Owner must delete the HMAC received from the Device.</p>
</li>
<li>
<p>The Owner must not extend the Ownership Voucher before deciding to discard
    the key or HMAC.</p>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Intel Corporation - Released under CC BY 4.0 license</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../js/version-select.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
