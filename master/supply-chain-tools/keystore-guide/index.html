<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Secure Device Onboard Contributers">
        <link rel="canonical" href="https://secure-device-onboard.github.io/docs/supply-chain-tools/keystore-guide/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Keystore Guide - Secure Device Onboard</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Secure Device Onboard</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="navitem">
                                <a href="../../community/" class="nav-link">Community</a>
                            </li>
                            <li class="navitem">
                                <a href="../../releases/" class="nav-link">Releases</a>
                            </li>
                            <li class="navitem">
                                <a href="../../security-best-practices/security-best-practices/" class="nav-link">Security Best Practices</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Client SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../client-sdk/client-sdk-reference-guide/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../client-sdk/client-sdk-api-reference/" class="dropdown-item">API Reference</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">IOT Platform SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../iot-platform-sdk/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../iot-platform-sdk/running-the-demo/" class="dropdown-item">Running The Demo</a>
</li>
                                    
<li>
    <a href="../../iot-platform-sdk/development-guide/" class="dropdown-item">Development Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Rendezvous Service <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../rendezvous-service/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Supply Chain Tools <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../manufacturing/manufacturer-enablement-guide/" class="dropdown-item">Manufacturing Tools</a>
</li>
                                    
<li>
    <a href="../reseller/reseller-enablement-guide/" class="dropdown-item">Reseller Tools</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Keystore Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Reference Implementation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../protocol-reference-implementation/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">All-in-one Demo <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../all-in-one-demo/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Specification <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../protocol-specification/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/protocol-description/" class="dropdown-item">Protocol Description</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/protocol-data-types/" class="dropdown-item">Protocol Data Types</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/data-transmission-persistence/" class="dropdown-item">Data Transmission & Persistence</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/detailed-protocol-description/" class="dropdown-item">Detailed Protocol Description</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/resale-protocol/" class="dropdown-item">Resale Protocol</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/credential-reuse-protocol/" class="dropdown-item">Credential Reuse Protocol</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/appendix-b-device-provisioning-with-ecdsa/" class="dropdown-item">Appendix B - Device Provisioning with ECDSA</a>
</li>
                                    
<li>
    <a href="../../protocol-specification/appendix-c-secure-device-onboard-1-1-crypto-upgrade/" class="dropdown-item">Appendix C - Secure Device Onboard 1.1 Crypto Upgrade</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../reseller/reseller-enablement-guide/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../protocol-reference-implementation/introduction/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#terminology" class="nav-link">Terminology</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#reference-documents" class="nav-link">Reference Documents</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#step-1-key-store-file-initialization" class="nav-link">Step 1: Key Store File Initialization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#step-2-hardware-key-initialization" class="nav-link">Step 2: Hardware Key Initialization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#step-3-prepare-an-air-gap-system" class="nav-link">Step 3: Prepare an Air-Gap System</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#step-4-setup-the-secure-key-fob" class="nav-link">Step 4: Setup the Secure Key Fob</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#step-5-setting-up-a-secure-key-fob-from-an-existing-key-and-cert" class="nav-link">Step 5: Setting up a Secure Key Fob from an Existing Key and Cert</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Secure Device Onboard enhances the out-of-the-box setup and provisioning experience for connected IoT devices.</p>
<p>The SDO reseller toolkit addresses the needs of resellers, manufacturers, and others in the supply chain to transfer ownership of SDO devices.</p>
<p>To learn more about SDO, see <a href="#overview">Overview</a>.</p>
<h2 id="terminology">Terminology<a class="headerlink" href="#terminology" title="Permanent link">&para;</a></h2>
<p>Refer to the <a href="../../reference/">Secure Device Onboard Reference page</a>.</p>
<h2 id="reference-documents">Reference Documents<a class="headerlink" href="#reference-documents" title="Permanent link">&para;</a></h2>
<p>Refer to the <a href="../../reference/">Secure Device Onboard Reference page</a>.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The SDO supply chain tools (manufacturer and reseller toolkits) require a key pair to be used to extend the ownership voucher and in the case of elliptic-curve cryptography (ECC)-based devices, to extend the device certificate chain.</p>
<p>This key pair must be generated and be made available to the toolkits in either the key store file format or in the hardware key (secure key fob). The file option is typically used for development, test, and evaluation purposes while the hardware key must be used in a production environment.</p>
<p>Choose the appropriate method for your situation. This process must be done for each key type you need to support. Key types used in SDO devices include RSA256, ECC256, and ECC384. Depending on the type of devices you plan to support you will need to generate from 1 to 3 key types, each type resulting in a key store file and a set of keys.</p>
<h2 id="step-1-key-store-file-initialization">Step 1: Key Store File Initialization<a class="headerlink" href="#step-1-key-store-file-initialization" title="Permanent link">&para;</a></h2>
<p>Use the <strong>p12init.sh</strong> script provided along with the toolkit to generate the key store file. Before use, update the configuration in the file (For example, key store password and certificate validity period).</p>
<p>The script can be run directly on a Linux* OS. For Windows* OS, you will need to install the Cygwin* DLL from <a href="https://www.cygwin.com/">https://www.cygwin.com/</a> and run the script from a Cygwin* shell. If running with Cygwin*, be sure to add Java* to your path variable. For example, in a Cygwin* command window:</p>
<p>Export Path=\$PATH:"/cygdrive/C/program files/java/dk-11/bin"</p>
<p>You should now have a key store file that can be used by the toolkit. You will need to provide the name of this file and the password you used here to the toolkit web service later.</p>
<h2 id="step-2-hardware-key-initialization">Step 2: Hardware Key Initialization<a class="headerlink" href="#step-2-hardware-key-initialization" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Sensitive cryptographic material is handled during the initialization of a hardware key. For this reason, the system used here needs to be secure. the Secure Device onboard project strongly recommends an air-gap system as detailed in <a href="#step-3-prepare-an-air-gap-system">Step 3: Prepare an Air-Gap System</a>.</p>
</li>
<li>
<p>The key pair backup must be stored securely where only authorized personnel have access to. Should this key pair be compromised, all active devices initialized with this key pair may be required to be re-initialized with SDO.</p>
</li>
</ol>
<h2 id="step-3-prepare-an-air-gap-system">Step 3: Prepare an Air-Gap System<a class="headerlink" href="#step-3-prepare-an-air-gap-system" title="Permanent link">&para;</a></h2>
<p>The air-gap system is a machine that is as follows:</p>
<ul>
<li>
<p>Has no network interface enabled (wired, wireless, or other such as Bluetooth<sup>®</sup>).</p>
</li>
<li>
<p>Is free from any viruses or malware.</p>
</li>
<li>
<p>Can run the OpenSSL* toolkit.</p>
</li>
<li>
<p>Has a USB* interface.</p>
</li>
</ul>
<p>Before the system is taken off the network, download the Yubikey* smart card driver and tools (<a href="https://www.yubico.com/products/services-software/download/smart-card-drivers-tools/">https://www.yubico.com/products/services-software/download/smart-card-drivers-tools/</a>).</p>
<h2 id="step-4-setup-the-secure-key-fob">Step 4: Setup the Secure Key Fob<a class="headerlink" href="#step-4-setup-the-secure-key-fob" title="Permanent link">&para;</a></h2>
<p>Use the <strong>ykinit.sh</strong> script provided along with the toolkit to set up the secure key fob (YubiKey* security key). You will need one YubiKey* security key for each key type you wish to support.</p>
<ol>
<li>
<p>Copy this script to the system prepared in <a href="#step-3-prepare-an-air-gap-system">Step 3: Prepare an Air-Gap System</a>.</p>
</li>
<li>
<p>Insert a YubiKey* security key into the system.</p>
</li>
<li>
<p>Run the script and select the desired key type. (If running on Windows* OS, you will need to install the Cygwin* to run the script).</p>
</li>
<li>
<p>Make a backup of the output files produced by the script. A backup copy of the key material is useful if any of your key fobs fail. You can use this backup to create a replacement key fob. Be sure to store this copy in a physically secure location that is only accessible by authorized personnel.</p>
</li>
<li>
<p>Use the YubiKey manager to change the pin code on the YubiKey* security key. You will need to specify this pin code to the application later. Example: ykman piv -change-pin</p>
</li>
<li>
<p>For each additional key type (For example, EC256, EC384, RSA2048), repeat steps 2 to 5. One Yubikey* security key is required for each key type.</p>
</li>
</ol>
<h2 id="step-5-setting-up-a-secure-key-fob-from-an-existing-key-and-cert">Step 5: Setting up a Secure Key Fob from an Existing Key and Cert<a class="headerlink" href="#step-5-setting-up-a-secure-key-fob-from-an-existing-key-and-cert" title="Permanent link">&para;</a></h2>
<p>Follow the steps in this section to set up a Yubikey* security key from the existing key material. These steps produce a backup Yubikey* security key or an additional Yubikey* security key for use with multiple Toolkit installations where all Toolkits need to use the same key pair.</p>
<p>Locate the copies of the crt (refer to the definition at the end of this section) and key files from the original setup process. The following are steps to set up each Yubikey* security key required:</p>
<ol>
<li>
<p>ykman piv reset</p>
</li>
<li>
<p>ykman piv import-key --management-key \&lt;mkey> 9a \&lt;key file></p>
</li>
<li>
<p>ykman piv import-certificate --management-key \&lt;mkey> 9a \&lt;crt file></p>
</li>
<li>
<p>Use the YubiKey* manager to change the pin code on the YubiKey* security key: ykman piv change-pin</p>
</li>
</ol>
<p>where mkey is the Yubikey* management key (default value is 010203040506070801020304050607080102030405060708)</p>
<p>key file = filename containing the private key</p>
<p>crt file = filename containing the certificate</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Intel Corporation - Released under CC BY 4.0 license</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
