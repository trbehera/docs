<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Secure Device Onboard Contributers">
        <link rel="canonical" href="https://secure-device-onboard.github.io/docs/supply-chain-tools/manufacturing/manufacturer-enablement-guide/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Manufacturing Tools - Secure Device Onboard</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../../css/version-select.css" rel="stylesheet">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Secure Device Onboard</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../reference/" class="nav-link">Reference</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../community/" class="nav-link">Community</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../releases/" class="nav-link">Releases</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../security-best-practices/security-best-practices/" class="nav-link">Security Best Practices</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Client SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../client-sdk/client-sdk-reference-guide/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../../client-sdk/client-sdk-api-reference/" class="dropdown-item">API Reference</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">IOT Platform SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../iot-platform-sdk/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../../iot-platform-sdk/running-the-demo/" class="dropdown-item">Running The Demo</a>
</li>
                                    
<li>
    <a href="../../../iot-platform-sdk/development-guide/" class="dropdown-item">Development Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Rendezvous Service <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../rendezvous-service/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Supply Chain Tools <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Manufacturing Tools</a>
</li>
                                    
<li>
    <a href="../../reseller/reseller-enablement-guide/" class="dropdown-item">Reseller Tools</a>
</li>
                                    
<li>
    <a href="../../keystore-guide/" class="dropdown-item">Keystore Guide</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Reference Implementation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../protocol-reference-implementation/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">All-in-one Demo <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../all-in-one-demo/introduction/" class="dropdown-item">Introduction</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Protocol Specification <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../protocol-specification/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/protocol-description/" class="dropdown-item">Protocol Description</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/protocol-data-types/" class="dropdown-item">Protocol Data Types</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/data-transmission-persistence/" class="dropdown-item">Data Transmission & Persistence</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/detailed-protocol-description/" class="dropdown-item">Detailed Protocol Description</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/resale-protocol/" class="dropdown-item">Resale Protocol</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/credential-reuse-protocol/" class="dropdown-item">Credential Reuse Protocol</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/appendix-b-device-provisioning-with-ecdsa/" class="dropdown-item">Appendix B - Device Provisioning with ECDSA</a>
</li>
                                    
<li>
    <a href="../../../protocol-specification/appendix-c-secure-device-onboard-1-1-crypto-upgrade/" class="dropdown-item">Appendix C - Secure Device Onboard 1.1 Crypto Upgrade</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../../rendezvous-service/introduction/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../reseller/reseller-enablement-guide/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#evaluation-deployment" class="nav-link">Evaluation Deployment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#production-deployment" class="nav-link">Production Deployment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#database-and-toolkit-installation" class="nav-link">Database and Toolkit Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#usage-scenario" class="nav-link">Usage Scenario</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#testing-with-an-sdo-device" class="nav-link">Testing with an SDO Device</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Secure Device Onboard (SDO) enhances the out-of-the-box setup and provisioning experience for connected IoT devices.
The Secure Device Onboard project provides the manufacturer toolkit and reseller toolkit for manufacturers (OEMs, ODMs, or 3rd party integrators) to enable SDO on their devices.
This document details how a manufacturer can use these tools to produce an SDO-enabled device. </p>
<h3 id="terminology">Terminology<a class="headerlink" href="#terminology" title="Permanent link">&para;</a></h3>
<p>Refer to the Secure Device Onboard <a href="../../../reference/">Reference page</a>.</p>
<h3 id="related-documents">Related Documents<a class="headerlink" href="#related-documents" title="Permanent link">&para;</a></h3>
<p>Your role as a supply chain integrator is combined with solutions implemented by manufacturers and device management service providers to enable a complete end-to-end experience. For more information, refer to the Secure Device Onboard <a href="../../../reference/">Reference page</a>. </p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>To produce Secure Device Onboard (SDO)-enabled devices, a manufacturer must run the SDO device initialization (DI) protocol on the device. The DI process sets security credentials in secure storage in the device and creates the initial ownership voucher.
The manufacturer makes use of the provided tools for this process: a manufacturer toolkit, an SDO Database, and software that runs on the device to perform DI.
The manufacturer toolkit acts as a DI server for the devices. After running DI on the device, the resulting ownership voucher is stored in the SDO Database. At this point, the SDO security credentials have been stored in the device and the device is SDO ready. When the device is sold to a customer, the ownership voucher is extended and shipped along with the device. 
A complete integration and deployment of SDO in a manufacturing environment requires a fair amount of planning and effort. However, for development, test, and enabling purposes, a much simpler evaluation deployment can be done. </p>
<h3 id="manufacturer-toolkit">Manufacturer Toolkit<a class="headerlink" href="#manufacturer-toolkit" title="Permanent link">&para;</a></h3>
<p>The main function of the manufacturer toolkit is to serve as a DI protocol server. The manufacturer toolkit runs as a web service and makes use of the SDO Database for configuration and storage of ownership vouchers. 
All configuration and data for the manufacturer toolkit is stored in the SDO Database. Views are used to read data while stored procedures are used to update the configuration. The following figure shows an overview of the SDO database.</p>
<p>Figure 1.   An Overview of the SDO Database
<img alt="Overview of the SDO Database" src="../img/Slide3.PNG" /></p>
<h2 id="evaluation-deployment">Evaluation Deployment<a class="headerlink" href="#evaluation-deployment" title="Permanent link">&para;</a></h2>
<p>The evaluation deployment is useful for development, test, and enabling purposes. The evaluation deployment can fully initialize a device to the same extent as the production deployment but does not require any integration with business systems nor the setup of a secure key fob.</p>
<h3 id="step-1-prepare-hardware-infrastructure">Step 1: Prepare Hardware Infrastructure<a class="headerlink" href="#step-1-prepare-hardware-infrastructure" title="Permanent link">&para;</a></h3>
<p>You need to have one machine that can run the manufacturer toolkit as well as host the Secure Device Onboard (SDO) database. A non-production environment has minimal requirements; the machine can run either the Linux* OS (version 18.04) or Windows* 10 OS.</p>
<h3 id="step-2-deploy-database-and-toolkit">Step 2: Deploy Database and Toolkit<a class="headerlink" href="#step-2-deploy-database-and-toolkit" title="Permanent link">&para;</a></h3>
<p>Install the SDO database and toolkit, see <a href="#database-and-toolkit-installation">Database and Toolkit Installation</a>. It is recommended to choose the key store file option unless there is a specified need to test with a secure key fob. </p>
<h3 id="step-3-test">Step 3: Test<a class="headerlink" href="#step-3-test" title="Permanent link">&para;</a></h3>
<p>Set up the device to run the SDO DI protocol (refer to device specific documentation for details). Run DI on the device against the manufacturer toolkit web service. Use the database view to query the device state and verification completion of the DI.</p>
<h2 id="production-deployment">Production Deployment<a class="headerlink" href="#production-deployment" title="Permanent link">&para;</a></h2>
<h3 id="step-1-integrate-with-business-system-processes">Step 1: Integrate with Business System Processes<a class="headerlink" href="#step-1-integrate-with-business-system-processes" title="Permanent link">&para;</a></h3>
<p>Producing Secure Device Onboard (SDO)-enabled devices requires integration with your business systems and manufacturing processes.<br />
Your business system processes need to:  </p>
<ul>
<li>Manage SDO public key(s) from customers, and the public key(s) storage in the SDO database. 
SDO requires the customer’s SDO public key. Your customer interactions and processes must be modified as required to support this receipt of their public key and then to import this key into the SDO Database. See <a href="#import-customer-public-key">Import Customer Public Key</a>.
Whether this key is delivered with each order or done before separately depends on your processes and interaction with your customers.  </li>
<li>Manage ownership vouchers sent to customers.<br />
After a device is initialized with SDO, an initial ownership voucher is produced and stored in the SDO Database. This voucher must first be “signed” to a customer before sending to the customer.  </li>
</ul>
<p>The ownership voucher management task has the following two steps:  </p>
<ol>
<li>Assign a voucher (device) to a customer (technically, a customer public key) See <a href="#assign-device-voucher-to-customer">Assign Device (Voucher) to Customer</a>. </li>
<li>Perform voucher extension. The resulting extended voucher can then be sent to the customer.  </li>
</ol>
<p>The following are the implied requirements:  </p>
<ol>
<li>It is assumed that you already have some way to track which device was shipped with which order. Most likely, this was done with serial numbers. With SDO, there is an additional requirement that you must match voucher(s) with physical devices such that the voucher(s) delivered to the customer are those that correspond to the actual physical devices that are delivered.</li>
<li>You need to update or modify the existing B2B channel to include an ownership voucher for each physical device delivered to the customer. Typically, these vouchers would be linked to the order in a particular way, but the details will vary for each manufacturer.</li>
<li>If a customer loses one of these vouchers and requires a replacement, then you must re-generate this voucher or retrieve the voucher from the device or order data if you choose to store the extended voucher with the device or order data.</li>
</ol>
<p>The following figure shows a typical usage scenario between your business systems and the SDO tools. The order and timing of each sequence may vary with your manufacturing, ordering, and inventory management processes. The only firm requirement is that Seq 1 and Seq 2 happens before Seq 3.</p>
<p>Figure 2.   A Typical Usage Scenario between Business Systems and SDO Tools</p>
<p><img alt="Usage Scenario between Business Systems and SDO Tools" src="../img/Slide4.PNG" /></p>
<h3 id="step-11-device-serial-number">Step 1.1: Device Serial Number<a class="headerlink" href="#step-11-device-serial-number" title="Permanent link">&para;</a></h3>
<p>SDO requires the correct ownership voucher to be delivered with each physical device. Therefore, an identifier that is present on the physical device, for example the serial number, can be used.
Scanning an identifier on the physical device allows for the correct voucher to be selected (if an incorrect voucher is delivered, SDO will fail later in the supply chain when run). If, for example, the serial number is already known, the correct physical device can be selected.
The same identifier must also be used when running the DI because the identifier is used as an index when storing vouchers in the SDO Database, and later when identifying vouchers.  </p>
<h3 id="step-12-customer-descriptor">Step 1.2: Customer Descriptor<a class="headerlink" href="#step-12-customer-descriptor" title="Permanent link">&para;</a></h3>
<p>A customer descriptor is used when importing customer public keys and assigning a voucher to a customer. This descriptor is a string value that must uniquely identify the customer. It is up to you, the manufacturer, to form this value. Duplicates are to be avoided because this value would be used when importing public keys and extending ownership vouchers.</p>
<h3 id="step-13-deploy-for-multiple-key-types">Step 1.3: Deploy for Multiple Key Types<a class="headerlink" href="#step-13-deploy-for-multiple-key-types" title="Permanent link">&para;</a></h3>
<p>If you, as a manufacturer, produces both the Rivest–Shamir–Adleman (RSA)- and elliptic-curve cryptography (ECC)-based devices, you will need to support two different key types. However, because of the limitations of the secure key fob (For example, Yubikey*), the deployment of multiple key types requires that multiple secure key fobs, each with one type of key pair, be used. The following figure shows a usage example. </p>
<p>Figure 3.   An Example of Using Two Different Key Types</p>
<p><img alt="Using Two Different Key Types" src="../img/Slide5.PNG" /></p>
<h3 id="step-14-deploy-for-multiple-manufacturing-stations">Step 1.4: Deploy for Multiple Manufacturing Stations<a class="headerlink" href="#step-14-deploy-for-multiple-manufacturing-stations" title="Permanent link">&para;</a></h3>
<p>If you are manufacturing SDO devices at multiple geographic locations, then you will need to consider how best to deploy the SDO Manufacturer Toolkit. A typical option is shown below. 
Install the toolkit and an SDO Database at each location – both at the remote GEOs as well as the central location. Each manufacturing GEO performs device initialization while the central location performs the Ownership Voucher extension. A data collection process is periodically invoked to collect data from each GEO’s SDO Database and import it into the central SDO Database. </p>
<p><img alt="Deploy for Multiple Manufacturing station" src="../img/Slide6.PNG" /></p>
<h3 id="step-2-prepare-hardware-infrastructure">Step 2: Prepare Hardware Infrastructure<a class="headerlink" href="#step-2-prepare-hardware-infrastructure" title="Permanent link">&para;</a></h3>
<p>You need to acquire and put into place the following:  </p>
<ul>
<li>A system to host the manufacturer toolkit and SDO Database  </li>
<li>A private network to attach devices to the manufacturer toolkit  </li>
<li>Secure key fob(s)  </li>
</ul>
<p>The following tables list the hardware infrastructure for Linux*- and Windows*-based manufacturer toolkits, respectively.</p>
<p>Table 3.    Linux* OS-based Manufacturer Toolkit</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connectivity</td>
<td>Two Ethernet networks: one to connect   to the IoT device and a separate network to connect to the backend to provide   access to voucher data and the voucher extension operation.</td>
</tr>
<tr>
<td>Secure Key Fobs</td>
<td>YubiKey* security key (see <a href="https://www.yubico.com/products/yubikey-hardware/">https://www.yubico.com/products/yubikey-hardware/</a>)</td>
</tr>
<tr>
<td>Operating System</td>
<td>Ubuntu* OS version 16.x or 18.x</td>
</tr>
<tr>
<td>Software</td>
<td>Java* Runtime Environment (JRE) software version 11 </p>    Oracle* software (<a href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html">http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html</a>) </p>   or  </p> OpenJDK* (<a href="http://openjdk.java.net/install/index.html">http://openjdk.java.net/install/index.html</a>) </p>  · Apache Tomcat* (<a href="http://tomcat.apache.org/">http://tomcat.apache.org/</a>)   software version 8 or later </p>   · MariaDB* (<a href="https://mariadb.org/">https://mariadb.org/</a>)  server version 10.4 or later </p></td>
</tr>
</tbody>
</table>
<p>Table 4.    Windows* OS-based Manufacturer Toolkit</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connectivity</td>
<td>Two Ethernet networks: one to connect   to the IoT device and a separate network to connect to the backend to provide   access to voucher data and the voucher extension operation.</td>
</tr>
<tr>
<td>Secure Key Fobs</td>
<td>YubiKey* security key (see  <a href="https://www.yubico.com/products/yubikey-hardware/">https://www.yubico.com/products/yubikey-hardware/</a>)</td>
</tr>
<tr>
<td>Operating System</td>
<td>Windows* 10 OS or Windows Server* OS   version 2012 R2 or later, 64-bit version.</td>
</tr>
<tr>
<td>Software</td>
<td>Java<em> Runtime Environment (JRE) software version 11    Oracle* software (<a href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html">http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html</a>) </p>  or </p>  OpenJDK</em> (<a href="http://openjdk.java.net/install/index.html">http://openjdk.java.net/install/index.html</a>) </p>  · Apache Tomcat* (<a href="http://tomcat.apache.org/">http://tomcat.apache.org/</a>)   software version 8 or later </p>  · MariaDB* (<a href="https://mariadb.org/">https://mariadb.org/</a>)  server version 10.4 or later  </p>  · OpenSC Utilities (<a href="https://github.com/OpenSC/OpenSC/releases/download/0.17.0/OpenSC-0.17.0-win64_vs12-Release.msi">https://github.com/OpenSC/OpenSC/releases/download/0.17.0/OpenSC-0.17.0-win64_vs12-Release.msi</a>.   After the installation, you will find the following DLL file installed: C:\windows\system32\opensc-pkcs11.dll</td>
</tr>
</tbody>
</table>
<h3 id="step-3-deploy-database-and-manufacturer-toolkit">Step 3: Deploy Database and Manufacturer Toolkit<a class="headerlink" href="#step-3-deploy-database-and-manufacturer-toolkit" title="Permanent link">&para;</a></h3>
<p>Install the SDO database and toolkit, see <a href="#database-and-toolkit-installation">Database and Toolkit Installation</a>. Be sure to use the secure key fob option for the key storage. </p>
<h3 id="step-4-validate-with-test-device">Step 4: Validate with Test Device<a class="headerlink" href="#step-4-validate-with-test-device" title="Permanent link">&para;</a></h3>
<p>Set up an SDO-capable device to run the SDO DI protocol (see <a href="#device-di-setup">Device DI Setup</a>). Run DI on the device against the manufacturer toolkit web service. Use the database view to query the device state and verify the completion of DI.</p>
<h2 id="database-and-toolkit-installation">Database and Toolkit Installation<a class="headerlink" href="#database-and-toolkit-installation" title="Permanent link">&para;</a></h2>
<p>You can either use the Docker* script provided or deploy manually.</p>
<h3 id="setup-docker-script">Setup: Docker* Script<a class="headerlink" href="#setup-docker-script" title="Permanent link">&para;</a></h3>
<p>The Docker* script requires a key store file containing the manufacturer keys. See <a href="../../keystore-guide/">Supply Chain Tools Key Store Setup Guide</a> for details. 
For the remaining setup, follow the instructions in the readme file in the SDO Docker directory.</p>
<h3 id="setup-manual">Setup: Manual<a class="headerlink" href="#setup-manual" title="Permanent link">&para;</a></h3>
<ol>
<li>For the following steps, run as root or use sudo.</li>
<li>Install the MariaDB* server from <a href="https://mariadb.org/">https://mariadb.org/</a>.</li>
<li>For each of the following commands, use the ‘root’ user you defined in step 2 where you installed the MariaDB* server and run each script on the machine where the MariaDB* server is installed. You’ll find the scripts in both the source (scripts/mysql) and binary (docker_*) files of the release.</li>
<li>Edit rt_config.sql and mt_config.sql as directed by the comments in each file. (These files are located in the sources of the SDO release package under /SupplyChainTools/scripts/mysql or /SupplyChainTools/scripts/sqlserver).    </li>
<li>Run the rt_create.sql script:<br />
<code>mysql -u &lt;username&gt; -p &lt; rt_create.sql</code></li>
<li>Run the mt_create.sql script:<br />
<code>mysql -u &lt;username&gt; -p &lt; mt_create.sql</code></li>
<li>Run the rt_config.sql script:<br />
<code>mysql -u &lt;username&gt; -p &lt; rt_config.sql</code></li>
<li>Run the mt_config.sql script:<br />
<code>mysql -u &lt;username&gt; -p &lt; mt_config.sql</code></li>
<li>Create a key store containing the manufacturer keys. See <a href="../../keystore-guide/">Supply Chain Tools Key Store Setup Guide</a> for details. </li>
<li>Set up and deploy the toolkit web service. If this is an evaluation deployment, you have an option to run the web service directly from the command line. If you choose to do this, instructions are provided in the readme file included with the toolkit software. Follow those instructions. You can verify that the toolkit starts up correctly by looking at the output in the window where you ran the toolkit. Installation is then complete, and you can skip the following steps. For example, if running directly:<br />
<code>java -Dspring.datasource.url="jdbc:mariadb://localhost:3306/sdo" -Dspring.datasource.username=sdo_admin -Dspring.datasource.password=sdo -Dsdo.keystore="file:///sdo.p12" -Dsdo.keystore.password=123456 -jar ./manufacturer-webapp-1.8.war</code></li>
<li>Install the Apache Tomcat* software from <a href="http://tomcat.apache.org/">http://tomcat.apache.org/</a> or equivalent.</li>
<li>Update the listener port. Most likely this will be 8039 as the default for SDO Clients but this may vary because of your specific network environment. For example, with Apache Tomcat* version 8 on the Linux* machine, this setting can be found in var/lib/tomcat8/config/server.xml. Refer to the documentation specific to your Apache Tomcat* version and operating system.</li>
<li>Copy the manufacturer toolkit war file into the Apache Tomcat* webapps directory (on the Linux* machine this would typically be /var/lib/tomcat8/webapps). Rename the war file to ROOT.war.</li>
<li>Start the Apache Tomcat* service. This will trigger the Apache Tomcat* software to unpack the war file and create individual files in the webapps/ROOT directory.</li>
<li>
<p>Add the remaining toolkit configuration for Apache Tomcat* (see the readme file included with the toolkit software for further details). For Apache Tomcat* version 8 running on the Linux machine, these settings are located in /var/lib/tomcat/webapps/ROOT/WEB-INF/classes/application.properties. An example is given as follows:<br />
<code>spring.datasource.url=jdbc:mariadb://localhost:3306/sdo?useSSL=false
    spring.datasource.username=sdo_admin
    spring.datasource.password=sdo
    sdo.keystore=file:///var/lib/tomcat8/webapps/ROOT/sdo.p12 
    sdo.keystore.password=123456</code>  </p>
<p><strong>Note:</strong> </p>
<ul>
<li>The database user and password should match those configured in rt_config.sql.</li>
<li>datasource.url: be sure to use localhost rather than the IP address.</li>
<li>sdo.keystore: this is either the pathname to the software key store (jks) or to the public key cryptography standards (PKCS#11) library if using secure key fob. Be sure to not use quotes around the value.</li>
<li>sdo.keystore.password: this is the password for the software key store or the pin code of the secure key fob.  </li>
</ul>
</li>
<li>
<p>Start or restart the Apache Tomcat* service.  </p>
</li>
<li>Test with the status page: http://<hostname or ip>/api/v1/status. If the page does not load, look at the Apache Tomcat* logs to debug any errors.  </li>
</ol>
<h3 id="setup-troubleshooting">Setup: Troubleshooting<a class="headerlink" href="#setup-troubleshooting" title="Permanent link">&para;</a></h3>
<p>Troubleshoot using the following steps if the toolkit web service does not start correctly:  </p>
<ol>
<li>
<p>Verify that the JDBC* string is correct.  </p>
<p>An example is: jdbc:mariadb://localhost:3306/sdo. Be sure MariaDB* is included, the port is specified as 3306, and the host name is correct.  </p>
</li>
<li>
<p>Verify that the database user and password are correct.  </p>
<p>The user and password should be the same as those defined in rt_config.sql. You may wish to use some third-party database tool to log into the database to test that the user and password are correct.  </p>
</li>
<li>
<p>Verify the server settings  </p>
<p>Look at mt_config.sql and verify that the rendezvous info and validity intervals are specified. If the rendezvous info and validity intervals are not specified, the web service will not start up.  </p>
</li>
<li>
<p>Look at the Apache Tomcat* log (or run the web service from the command line and look at the output).  </p>
<p>The log messages will indicate the error.  </p>
</li>
</ol>
<h2 id="usage-scenario">Usage Scenario<a class="headerlink" href="#usage-scenario" title="Permanent link">&para;</a></h2>
<h3 id="verify-device-initialization-di">Verify Device Initialization (DI)<a class="headerlink" href="#verify-device-initialization-di" title="Permanent link">&para;</a></h3>
<p>To determine the state of a device or devices, the database view, v_mt_device_state, is available. Data can be retrieved programmatically with a third-party database tool or through the command line:</p>
<pre><code>mysql -u &lt;username&gt; -p -h &lt;SDO database server hostname or ip&gt; -e “use sdo; select * from v_mt_device_state”
</code></pre>

<h3 id="import-customer-public-key">Import Customer Public Key<a class="headerlink" href="#import-customer-public-key" title="Permanent link">&para;</a></h3>
<p>Import the customer public key by calling the <strong>rt_add_customer_public_key</strong> stored procedure. In a production environment, the import would likely be invoked programmatically. For test, development, or evaluation purposes, run from the command line as follows:</p>
<pre><code>mysql -u &lt;username&gt; -p -h &lt;SDO database server hostname or ip&gt; -e “use sdo; call rt_add_customer_public_key('CUST_DIST_12345', '-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqGKukO1De7zhZj6+H0qtjTkVxwTCpvKe4eCZ0
FPqri0cb2JZfXJ/DgYSF6vUpwmJG8wVQZKjeGcjDOL5UlsuusFncCzWBQ7RKNUSesmQRMSGkVb1/
3j+skZ6UtW+5u09lHNsj6tQ51s1SPrCBkedbNf0Tp0GbMJDyR4e9T04ZZwIDAQAB
-----END PUBLIC KEY-----’)”
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be sure this is the public key pem and not the certificate pem. The public key can be extracted from the certificate with OpenSSL*:<br />
<code>openssl x509 -pubkey -noout -in &lt;cert file&gt;.pem &gt; &lt;pubkey&gt;.pem</code>  </p>
</div>
<h3 id="assign-device-voucher-to-customer">Assign Device (Voucher) to Customer<a class="headerlink" href="#assign-device-voucher-to-customer" title="Permanent link">&para;</a></h3>
<p>Assign the device (voucher) by calling the <strong>rt_assign_device_to_customer</strong> stored procedure. In a production environment, the assignment would likely be invoked programmatically. For test, development, or evaluation purposes, run from the command line as follows:  </p>
<pre><code>mysql -u &lt;username&gt; -p -h &lt;SDO database server hostname or ip&gt; -e “use sdo; call rt_assign_device_to_customer(‘SN12345678’, ’CUST_DIST_12345’)”
</code></pre>

<h3 id="extend-ownership-voucher">Extend Ownership Voucher<a class="headerlink" href="#extend-ownership-voucher" title="Permanent link">&para;</a></h3>
<p>Ownership voucher is extended through the REST API. In a production environment, the extension would be done programmatically. For test purposes, you can use <strong>curl</strong> to invoke the extension:</p>
<pre><code>curl -X GET http://&lt;mfr toolkit ip&gt;:&lt;PORT&gt;/api/v1/vouchers/&lt;device serial no&gt; 
</code></pre>

<p>The result will be the extended voucher.</p>
<h2 id="testing-with-an-sdo-device">Testing with an SDO Device<a class="headerlink" href="#testing-with-an-sdo-device" title="Permanent link">&para;</a></h2>
<p>Any device that can run the SDO DI protocol can be used to perform an end-to-end test of the Manufacturing Toolkit. If an SDO device is not available, then the SDO PRI Device can be used. This is a Java based Device Simulator that can run anywhere Java is supported. Please refer to the readme in the PRI directory of the SDO release package for details on how to run this device.  </p>
<p>Regardless of which device is used, care must be taken when specifying the value of the device m-string in the DI protocol. See next section for details.  </p>
<h3 id="device-m-string">Device m-string<a class="headerlink" href="#device-m-string" title="Permanent link">&para;</a></h3>
<p>The m-string is used to provide device-specific information that is used to manage ownership vouchers. The m-string must be present and cannot be empty (the manufacturer toolkit will output an error in such case). </p>
<p>In the development, test, or enablement environment, any non-empty value can be used (For example, “deviceA” or “deviceB”). The manufacturer toolkit will take the entire m value as the device serial number. </p>
<p>For the production environment, creating the m-string value is complex, therefore, it is recommended to use a script to generate the value.
The m-string is a base 64-encoded set of null terminated string values as follows:</p>
<p><code>&lt;key type identifier&gt;&lt;null-1&gt;&lt;serial number&gt;&lt;null-2&gt;&lt;model number&gt;[&lt;null-3&gt;&lt;CSR&gt;]</code>  </p>
<p>where:  </p>
<ul>
<li>
<p><code>&lt;null&gt;</code> translates to value 0x00  </p>
</li>
<li>
<p><code>&lt;null-1&gt;</code> and <code>&lt;null-2&gt;</code> are mandatory  </p>
</li>
<li>
<p><code>Key type identifier</code> = 1 | 13 | 14  </p>
<p>1 = RSA256, 13 = ECC256, 14 = ECC384  </p>
<p>Identifies the type of cryptography used on the device. They key type used to extend ownership vouchers must match this type.</p>
</li>
<li>
<p><code>Serial number</code> = device serial number  </p>
<p>The serial number should uniquely identify the device and ideally, should be present on the device itself (such as, the label). It is used to correlate the device with its associated ownership voucher by manufacturers and resellers when shipping devices.  </p>
</li>
<li>
<p><code>Model number</code> = device model number  </p>
<p>The model number should identify the type of device model. This data is not strictly required and can be empty if desired.  </p>
</li>
<li>
<p><code>CSR</code> = certificate signing request.   </p>
<p>The CSR is optional and is only required for ECC devices. <null-3> is required only if the CSR is included. The format of the CSR should be base 64-encoded public key cryptography standards (PKCS#10) in privacy-enhanced mail (PEM) format.</p>
</li>
</ul>
<p>An example of how to generate the m-string value is given below. This can be leveraged to programmatically generate the sdo_di -mi arg. </p>
<p><code>$ echo -ne '1\0serial\0model' | base64</code>  </p>
<p>MQBzZXJpYWwAbW9kZWw=  </p>
<p>And a demonstration of what’s in the encoding:  </p>
<p><code>$ echo -ne '1\0serial\0model' | base64 | base64 -d | xxd</code></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Intel Corporation - Released under CC BY 4.0 license</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../js/version-select.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
